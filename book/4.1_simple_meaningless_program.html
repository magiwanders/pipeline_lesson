<!DOCTYPE HTML>
<html lang="it" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DEMO - Meaningless Program - Introduction to Pipelining</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="scrollbar.css">
        <link rel="stylesheet" href="loader.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="0_navigating_this_lesson.html"><strong aria-hidden="true">1.</strong> Navigating This Lesson</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="0.1_vm_setup.html"><strong aria-hidden="true">1.1.</strong> Virtual Machine Setup</a></li><li class="chapter-item expanded "><a href="0.2_important_info.html"><strong aria-hidden="true">1.2.</strong> Important Info on the Virtual Machine</a></li><li class="chapter-item expanded "><a href="0.3_pretest.html"><strong aria-hidden="true">1.3.</strong> Pre-test</a></li></ol></li><li class="chapter-item expanded "><a href="1_prerequisites.html"><strong aria-hidden="true">2.</strong> Prerequisites</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1.1_exercises.html"><strong aria-hidden="true">2.1.</strong> Review of RISC-V Instruction Set, 2's complement and Hex Calculations</a></li><li class="chapter-item expanded "><a href="1.3_components_review.html"><strong aria-hidden="true">2.2.</strong> Review of Single Cycle Processor Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1.4_single_register.html"><strong aria-hidden="true">2.2.1.</strong> Single Register</a></li><li class="chapter-item expanded "><a href="1.5_rom.html"><strong aria-hidden="true">2.2.2.</strong> ROM</a></li><li class="chapter-item expanded "><a href="1.6_register_file.html"><strong aria-hidden="true">2.2.3.</strong> Register File</a></li><li class="chapter-item expanded "><a href="1.7_pc.html"><strong aria-hidden="true">2.2.4.</strong> PC</a></li><li class="chapter-item expanded "><a href="1.8_alu.html"><strong aria-hidden="true">2.2.5.</strong> ALU</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="2_timing.html"><strong aria-hidden="true">3.</strong> Circuit Timing (contains SHEAS Tutorial)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="2.1_propagation_delay.html"><strong aria-hidden="true">3.1.</strong> Consequences of a Non-Negligible Propagation Delay</a></li><li class="chapter-item expanded "><a href="2.3_rtl.html"><strong aria-hidden="true">3.2.</strong> Review of Register Transfer Level (RTL) abstraction</a></li><li class="chapter-item expanded "><a href="2.5_diagramma_rtl.html"><strong aria-hidden="true">3.3.</strong> A Diagram for Graphing the Dynamic Behaviour of RTL Circuits</a></li><li class="chapter-item expanded "><a href="2.6_pipeline.html"><strong aria-hidden="true">3.4.</strong> Introduction to the Pipelined Processor</a></li></ol></li><li class="chapter-item expanded "><a href="3_building_the_pipeline.html"><strong aria-hidden="true">4.</strong> Building the Pipelined Processor (contains Ripes Tutorial)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="3.1_from_singlecycle.html"><strong aria-hidden="true">4.1.</strong> Grouping the Components of the Single-Cycle Processor</a></li><li class="chapter-item expanded "><a href="3.4_stages.html"><strong aria-hidden="true">4.2.</strong> An Overview of how Each Inctruction Activates Each Stage</a></li></ol></li><li class="chapter-item expanded "><a href="4_demos.html"><strong aria-hidden="true">5.</strong> Towards Hazards</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="4.1_simple_meaningless_program.html" class="active"><strong aria-hidden="true">5.1.</strong> DEMO - Meaningless Program</a></li><li class="chapter-item expanded "><a href="4.2_towards_hazards.html"><strong aria-hidden="true">5.2.</strong> DEMO - Program Towards Hazards</a></li><li class="chapter-item expanded "><a href="4.3_assignments.html"><strong aria-hidden="true">5.3.</strong> Assignment on Hazards</a></li></ol></li><li class="chapter-item expanded "><a href="5_appendix.html"><strong aria-hidden="true">6.</strong> RV32IMAC Cheat Sheet</a></li><li class="chapter-item expanded "><a href="5.1_posttest.html"><strong aria-hidden="true">7.</strong> Post-test</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Introduction to Pipelining</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="demo---simple-meaningless-program"><a class="header" href="#demo---simple-meaningless-program">DEMO - Simple Meaningless Program</a></h1>
<iframe width="100%" height="500" src="https://www.youtube.com/embed/ypJFmc6LgI4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="program"><a class="header" href="#program">Program</a></h2>
<ul>
<li>Ripes Processor: <code>5-stage processor (w/o forwarding or hazard detection) Extended</code></li>
<li>Registers to Initialize:
<ul>
<li><code>a0 = 0x5</code></li>
</ul>
</li>
<li>Program:</li>
</ul>
<pre><code class="language-assembly">sw a0 0xbc(x0)   # M[0xbc]=a0
li a1 0x7        # -&gt; a1 = 7
li a2 0x3        # -&gt; a2 = 3
lw a3 0xbc(x0)   # a3=M[0xbc]
LOOP:
    add a4 a0 a1     # -&gt; a4=a0+a1
    sub a5 a1 a2     # -&gt; a5=a1-a2
    add a4 a3 a3     # -&gt; a4=a3+a3
    slli a3 a3 1     # -&gt; a3=a3&lt;&lt;1
    bne a5 x0 LOOP    # Branch if a5 is different from zero
</code></pre>
<h2 id="transcript"><a class="header" href="#transcript">Transcript</a></h2>
<p>The first program actually does nothing meaningful, which helps us focus on how it flows through the processor. We will comment on each cycle of the execution. I suggest pausing the video whenever you feel like you are ready to analyse the next step yourself, and then let the video continue to verify your work. For the Fetch stage we will focus on the choice of the next PC value, for the Decode stage we will focus on the flags that influence the behaviour of the other stages, for the execution stage we will focus on abstracting the alu function, in relation to the instruction function, while in the last two stages we will focus on the completion of the processing of each instruction.</p>
<p>Side note, it is very important that you know hex values and register ABI names by heart, as they will be used interchangeably for naming registers. For example, often values in the visualisations will be in hex, while the register file on the right will have both decimal and ABI representations, or again the assembly code will use ABI register names. Make sure to know them well, not to get confused.</p>
<p>First of all, load the 5 stage processor without forwarding or hazard detection with the extended layout.</p>
<p>Initialise register a0 to the value 5.</p>
<p>Copy and paste the program below in Ripes' Editor tab.</p>
<p>Let us first understand what the program does, even if meaningless. The first instruction loads the value of a0 into the memory cell with address &quot;bc&quot;. The second and the third instructions load 7 and 3 in a1 and a2 respectively. The fourth loads the content of the memory cell &quot;bc&quot; into a3. At this point we will expect a3 to hold the same value as a0.
The next four instructions are simple arithmetic operations. At the end of each we should see respectively a4 equal to 12, a5 equal to 4, a4 equal to 10, a3 equal to 10, because shifting left by 1 position is equivalent to multiplying by 2. The last instruction branches back to the label if a5 is different from zero. Since neither a1 or a2 are being written and a5 will remain their sum, we expect the branch to continue to be taken forever, while both a3 and a4 continue to be doubled forever at each loop.</p>
<p>Let us now comment the execution, cycle by cycle.</p>
<p>Let us now comment the execution, cycle by cycle.</p>
<p>Cycle Zero.</p>
<p>The first instruction is in the Fetch Stage. We can see that the instruction in hexadecimal coming out of the instruction memory, matches the one of the first instruction. This can be done with all following instructions. As we can see from this mux, the next program counter value will be the current one plus four, which means that the instruction immediately following the store will be loaded, in this case the load immediate, or addi. This will not always be the case, we will see what happens when the branch reaches the ex stage, which is where this mux that chooses the next program counter is controlled from.</p>
<p>Cycle One.</p>
<p>For the Fetch stage the same considerations apply as before.
At the same time the Decode stage now contains the store instruction. I remind you that not all the signals in this stage are used by each instruction. For example the store instruction does not have a destination register field, as it uses that same bit range to encode part of the immediate, but we can see some value here nonetheless. The processor ignores the values that have nothing to do with the current instruction, by just not using them. Therefore, we will ignore them too, but you have to know the Instruction Set, to know what to ignore and what to check. For the store instruction, we can verify that the source register 1, which is x0, and the source register 2, which is x10, are indeed retrieved from the register file. At the beginning of the program we expect x10 to contain the value 5, and we can verify it here. Also the immediate output corresponds to the expected value of 188. We can also verify that the register file write enable is not activated, as the store instruction does not have to write to the register file, later in the write back stage. On the other hand, the data memory write enable is active, as the store instruction will write to data memory in the memory stage. The other lit signal is the second operator selector for the alu, which will be used in the next cycle to select the immediate. Finally, one of the signals that is always a good measure to check is the alu control, which now has the value &quot;add&quot;. The store instruction uses the addition function of the alu, because it calculates the address for writing the data memory, by adding an offset, in this case 188, to the value of a register, in this case x0.</p>
<p>Cycle Two.</p>
<p>The execution stage now contains the store instruction and, as expected, the alu is summing the immediate 188 with the content of x0, which is always zero, resulting in 188. This value will be used to address the data memory during the next cycle.</p>
<p>The decode stage contains the load immediate instruction: as before we have to check only the relevant signals. In this case the register file write enable, as this instruction will write 7 in register x11 in the write back stage. The immediate 7, and the flag that allows the alu to use it, as well as the alu control flag, which is once again set on &quot;add&quot;. Finally, the write back select signal is set on alu result. That is because in the write back stage the value that has to be written, in this case to x11, is the result of the sum of 0 and the immediate 7.</p>
<p>As an example of why we ought to ignore the non relevant signals, the register 2 index signal contains the value 7. This has nothing to do with the immediate, just with its encoding. That very same subset of bits, that in other instructions decodes to the source register 2 index field, is used by the addi instruction to encode the immediate 7.</p>
<p>Cycle Three.</p>
<p>The store instruction is now in the Memory stage, and it will be here that it will complete its execution. It will do nothing in the next stage, unlike most other instructions. Here we can see the memory write enable being used, after being calculated in the decode stage two cycles ago. From the decode stage also comes the data in, which is just the content of register 2 and we can confirm it is the value 5, while as already said the address comes from the execution stage, as it is just the alu result.</p>
<p>However, if we look in the memory tab for the memory cell 0xbc, we see that it does not contain the value 5 just yet. This is because, as for any register and therefore any memory, it will show its output at the next cycle.</p>
<p>We can verify in the execution stage that the alu is indeed summing the immediate, with the value zero.</p>
<p>We are not going to repeat anything about the fetch stage, as it contains the very same type of instruction as last cycle. You can use it as exercise also for the next three cycles.</p>
<p>Cycle Four.</p>
<p>Here in the write back stage the instruction does nothing, but we can now verify in the Memory tab that it has actually written the value 5 into memory cell 0xbc.</p>
<p>The instruction in the memory stage also does nothing, as the addi instruction has nothing to do with the data memory.</p>
<p>We are not going to repeat anything about the execution stage, as it contains the very same type of instruction as last cycle. You can use it as exercise.</p>
<p>Finally, the decode stage contains the load: we can see that it will write to the register file in a few cycles, that it uses the immediate 0xbc in the next stage and that it reads from data memory.</p>
<p>Cycle Five.</p>
<p>Here in the write back stage the add immediate instruction finally completes its processing, by selecting the alu result, that two cycles ago was calculated as the sum of 0 and 7, and writing it to the register file at index 0xb.
Mind that at the same time another instruction is in the decode stage, and is doing some other thing in parallel. Since it is an add instruction it is reading two registers from the register file. This instruction is the first of a streak of 4 arithmetic operations, two examples of which you have already seen, so we will focus less on the details from now on.</p>
<p>Analysing the assembly, we found that we expect this add instruction to retrieve the register a0 with value 5, and the register a1 with value 7. However, on the right we can see that the register a1 is still zero, since the value is being written in this cycle and will be visible from the next. Fortunately, the implementation of the register file of this specific processor, allows for reading a register at the same time of it being written, so with input 0xb, which corresponds to a1, we can still see the value 7. But what if this was not the case or worse, what if the previous instruction, the load, needed the value of a1? The value was not ready at the previous cycle. We will cover this case in the next part of the lesson, so remember it.</p>
<p>So the add instruction retrieves the correct values of 5 and 7, and will write their sum in register 14 in the write back stage.</p>
<p>Cycle Six.</p>
<p>The next sub instruction needs the values of registers a1 and a2 being 7 and 3 respectively. Again while a1 is ready from the previous cycle, a2 is being written to the register file right now, as you can see, but thanks to the implementation of this specific register file, it can still be used by the sub instruction.</p>
<p>Cycle Seven.</p>
<p>The same happens now, when the load instruction is writing 5 to the register a3 from the write back stage,and the instruction in the decode stage needs to use it.</p>
<p>Cycle Eight.</p>
<p>None of the add and sub instructions do anything in the memory stage, and they complete their execution in the write back stage. Now, the first instruction of the streak is here in the write back, and all the others will complete here in the next cycles in the same way.</p>
<p>Cycle Nine.</p>
<p>Now the branch instruction is in the decode stage and needs the value of a5, which again is being written at the same time with the value 4. Being the last instruction of the program, the fetch stage remains empty. For confirmation we can see the program counter value in the fetch stage being 24, that is the address of the instruction just after the branch, which is empty. If you manage to sneak a malicious instruction there, congratulations, you have created a very rudimentary virus.</p>
<p>Anyway let us focus on the decoding of the branch instruction. The three lit flags are the do branch flag, the flag that switches the first alu input to the program counter, and the flag that switches the second alu input to the immediate. The alu operation is again &quot;Add&quot;, as the branch instruction in the next cycle will sum the program counter and the negative immediate, to obtain the address of the instruction to jump backwards to.</p>
<p>Remember that the difference between jump and branch is that the jump requires no condition, while the branch does.</p>
<p>Cycle Ten.</p>
<p>The first two stages are empty. The next instruction to fetch is being calculated in this cycle in the execution stage, and depends on whether the branch is taken. You can see the 'branch taken' flag being activated, and ultimately selecting the result of the alu as next program counter, back in the fetch stage. The new value of the program counter is the branch instruction address minus 16, which is the distance in bytes between the branch instruction and the targeted label. Note that the address on any instruction is the same value of the program counter, taken from when the instruction was in the decode stage: they are the same thing. The branch instruction will do nothing in the next two stages. At the next cycle the instruction whose address is the new program counter value will be retrieved. In this case, it is the first instruction of the loop.</p>
<p>From now on the execution will continue in the same way indefinitely.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="4_demos.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="4.2_towards_hazards.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="4_demos.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="4.2_towards_hazards.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="submodules/js_builds_html/html_builders.js"></script>
        <script type="text/javascript" src="submodules/paint2pic/p2p.js"></script>
        <script type="text/javascript" src="submodules/simple_hardware_editor_and_simulator/digitaljs_webpack_backup.js"></script>
        <script type="text/javascript" src="submodules/simple_hardware_editor_and_simulator/lz-string_backup.js"></script>
        <script type="text/javascript" src="submodules/simple_hardware_editor_and_simulator/sheas_functions.js"></script>
        <script type="text/javascript" src="submodules/simple_hardware_editor_and_simulator/sheas_builders.js"></script>
        <script type="text/javascript" src="lesson.js"></script>
    </body>
</html>
