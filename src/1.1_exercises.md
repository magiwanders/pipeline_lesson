# Esercizi sui Prerequisiti

Si ricorda che nella sezione [Appendice](./5_appendix.md) è presente un PDF riassuntivo dell'intero Instruction Set RV32IMAC.

1. Disassemblare le seguenti istruzioni:  
    1. ```0x01e007ef```   
    2. ```0x0001e7b7```                                                                    
    3. ```0x00440113```                                                                  
    4. ```0x40445113```                                                                  
    5. ```0x403100b3```                                                                  
    6. ```0xfea64ae3```                                                                   
    7. ```0x0003a583```                                                                  
    8. ```0x00b3a023```

2. Assemblare le seguenti istruzioni (ESEMPIO):
    1. ```j -12```                                                                             
    2. ```auipc sp 8```                                                                     
    3. ```andi sp, s0, 4```                                                               
    4. ```sltiu sp, s0, 4```                                                               
    5. ```or ra, sp, gp```                                                                      
    6. Solo l'istruzione di branch del seguente programma:  
        - ```<LABEL>```  
        - &nbsp;&nbsp;&nbsp;&nbsp;```lw a1 0(t2)```   
        - &nbsp;&nbsp;&nbsp;&nbsp;```add a2 a1 a1```  
        - &nbsp;&nbsp;&nbsp;&nbsp;```sw a1 0(t2)```  
        - &nbsp;&nbsp;&nbsp;&nbsp;```bgtz sp <LABEL>```                                   
    7. ```lw a7 8(t2)```                                                                   
    8. ```sw a7 8(t2)```
     


## Esempi di Svolgimento

### Disassemblaggio dell'istruzione ```0x01e007ef```

Per prima cosa si esegue la conversione da esadecimale a binario:

| hex |  ```0```   |  ```1```   |  ```e```   |  ```0```   |  ```0```   |  ```7```   |  ```e```   |  ```f```   |
|:---:|:----------:|:----------:|:----------:|:----------:|:----------:|:----------:|:----------:|:----------:|
| bin | ```0000``` | ```0001``` | ```1110``` | ```0000``` | ```0000``` | ```0111``` | ```1110``` | ```1111``` |

Poi si identifica il tipo di istruzione e i suoi campi, generalmente leggendo da destra a sinistra il binario, per più facile consultazione delle tabelle del Decoder nell'[Appendice](./5_appendix.md):

|  RV32I  | ```00000001111000000000``` |  ```01111```   |     ```11011```     |       ```11```       |
|:-------:|:--------------------------:|:--------------:|:-------------------:|:--------------------:|
| Meaning |   ```<imm> (encoded)```    |    ```rd```    |    ```opcode```     |    ```quadrant```    |
|  Value  |   ```<imm>```              |       15       |    Jump and Link    |         4th          |

Si ottiene quindi l'istruzione ```jal x15 <imm>```, dove ```<imm>``` è l'immediate in decimale ancora da calcolare.

Per tutti campi tranne ```<imm>``` il decoding del valore è infatti leggibile direttamente dalle tabelle. Per ```<imm>``` bisogna effettuare un passaggio in più (sostanzialmente un riordino di bit) prima di poterlo calcolare.

Si identificano i sotto-campi dell'immediate:

| ```<imm> (encoded)``` | ```0```  | ```0000001111``` | ```0```  | ```00000000``` |
|:---------------------:|:--------:|:----------------:|:--------:|:--------------:|
|       Encoding        | ```m2``` |    ```imm2```    | ```m1``` |   ```imm1```   |

Si riordinano i sottocampi come indicato nelle tabelle del Decoder nell'[Appendice](./5_appendix.md):

| Decoding di ```<imm>``` |     ```-m2-```     |   ```imm1```   | ```m1``` |    ```imm2```    | ```0``` |
|:-----------------------:|:------------------:|:--------------:|:--------:|:----------------:|:-------:|
| ```<imm> (bin)```       | ```000000000000``` | ```00000000``` | ```0```  | ```0000001111``` | ```0``` |

Si ottiene il numero in complemento a 2 
- ```<imm> (bin)``` = ```00000000000000000000000000011110``` in binario

ossia 
- ```<imm> (dec)``` = ```30``` in decimale.

L'istruzione disassemblata completa corrispondente a ```0x01e007ef``` è quindi ```jal x15 30```, o ```jal a5 30``` usando i nomi ABI dei registri.

### Assemblaggio dell'istruzione ```j -12```

Si controlla sulle tabelle dell'Encoder nell'[Appendice](./5_appendix.md) l'encoding dei campi dell'istruzione ```j```. 

| Encoding dell'istruzione ```j``` | ```<imm> (encoded)``` | 00000 |     11011     |    11    |
|:--------------------------------:|:---------------------:|:-----:|:-------------:|:--------:|

I bit meno significativi dell'istruzione in binario saranno quindi ```xxxxxxxxxxxxxxxxxxxx000001101111```. Rimane solo da convertire ```<imm> = 30 ``` in ```<imm> (encoded)```.

Per prima cosa si converte in complemento a due il decimale ```<imm>``` = ```-12```, che diventa ```<imm> (bin)``` = ```10100```, ```<imm> (bin)``` = ```11111111111111111111111111110100``` se esteso di segno per riempire tutti i ```32 bit```dell'Instruction Set.

Si divide questo numero nei dovuti sottocampi, come da Encoder nell'[Appendice](./5_appendix.md):

| ```<imm> (bin)```       | ```111111111111``` | ```11111111``` | ```1```  | ```1111111010``` | ```0``` |
|:-----------------------:|:------------------:|:--------------:|:--------:|:----------------:|:-------:|
| Decoding di ```<imm>``` |     ```-m2-```     |   ```imm1```   | ```m1``` |    ```imm2```    | ```0``` |

Si riordinano i sottcampi per ottenere l'immediate codificato:

|       Encoding        | ```m2``` |    ```imm2```    | ```m1``` |   ```imm1```   |
|:---------------------:|:--------:|:----------------:|:--------:|:--------------:|
| ```<imm> (encoded)``` | ```1```  | ```1111111010``` | ```1```  | ```11111111``` |

Si ottiene ```<imm> (encoded)``` = ```11111111010111111111xxxxxxxxxxxx```, ossia i bit più significativi dell'istruzione. 

L´istruzione completa in binario corrispondente a ```j -12``` è quindi ```11111111010111111111000001101111``` per concatenazione dei due risultati sopra.



